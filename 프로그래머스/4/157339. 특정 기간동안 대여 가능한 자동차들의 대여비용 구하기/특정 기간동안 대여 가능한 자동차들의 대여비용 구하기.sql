-- 코드를 입력하세요
SELECT A.CAR_ID, A.CAR_TYPE, FLOOR(A.DAILY_FEE*30 *(1-B.DISCOUNT_RATE/100)) AS FEE
FROM CAR_RENTAL_COMPANY_CAR A
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN B
ON A.CAR_TYPE = B.CAR_TYPE AND B.DURATION_TYPE = '30일 이상'
LEFT JOIN CAR_RENTAL_COMPANY_RENTAL_HISTORY C
ON A.CAR_ID = C.CAR_ID
AND ((C.START_DATE BETWEEN '2022-11-01' AND '2022-11-30')
OR (C.END_DATE BETWEEN '2022-11-01' AND '2022-11-30')
OR (C.START_DATE <= '2022-11-01' AND C.END_DATE >= '2022-11-30')
    )
WHERE A.car_type IN ('세단','SUV')
AND C.CAR_ID IS NULL
AND FLOOR(A.DAILY_FEE*30 *(1-B.DISCOUNT_RATE/100)) BETWEEN 500000 AND 1999999
ORDER BY 3 DESC, 2, 1 DESC;